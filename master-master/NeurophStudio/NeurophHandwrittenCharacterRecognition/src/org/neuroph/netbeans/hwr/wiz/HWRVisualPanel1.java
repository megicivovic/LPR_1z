package org.neuroph.netbeans.hwr.wiz;

import java.io.File;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.TreePath;

public final class HWRVisualPanel1 extends JPanel {

    /** Creates new form HWRVisualPanel1 */
    public HWRVisualPanel1() {
        initComponents();
        TreeManager.setLettersTreeModel(jTree1);

    }

    @Override
    public String getName() {
        return "Create training set by drawing letters";
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel5 = new javax.swing.JPanel();
        jPanel7 = new javax.swing.JPanel();
        saveLetterTrainingButton = new javax.swing.JButton();
        clearLetterTrainingButton = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        drawingPanelTrening = new org.neuroph.netbeans.hwr.wiz.DrawingPanel();
        jPanel8 = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTree1 = new javax.swing.JTree();
        jLabel2 = new javax.swing.JLabel();
        jImagePanel = new org.neuroph.netbeans.hwr.wiz.JImagePanel();
        clearTsButton = new javax.swing.JButton();

        jPanel5.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(HWRVisualPanel1.class, "HWRVisualPanel1.jPanel5.border.title"))); // NOI18N
        jPanel5.setMinimumSize(new java.awt.Dimension(200, 50));
        jPanel5.setPreferredSize(new java.awt.Dimension(300, 200));

        jPanel7.setLayout(new java.awt.GridBagLayout());

        org.openide.awt.Mnemonics.setLocalizedText(saveLetterTrainingButton, org.openide.util.NbBundle.getMessage(HWRVisualPanel1.class, "HWRVisualPanel1.saveLetterTrainingButton.text")); // NOI18N
        saveLetterTrainingButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveLetterTrainingButtonActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 5);
        jPanel7.add(saveLetterTrainingButton, gridBagConstraints);

        org.openide.awt.Mnemonics.setLocalizedText(clearLetterTrainingButton, org.openide.util.NbBundle.getMessage(HWRVisualPanel1.class, "HWRVisualPanel1.clearLetterTrainingButton.text")); // NOI18N
        clearLetterTrainingButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearLetterTrainingButtonActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.insets = new java.awt.Insets(0, 1, 0, 1);
        jPanel7.add(clearLetterTrainingButton, gridBagConstraints);

        jPanel6.setLayout(new java.awt.GridBagLayout());

        DrawingListener dl1 = new DrawingListener(drawingPanelTrening);
        drawingPanelTrening.addMouseMotionListener(dl1);
        drawingPanelTrening.addMouseListener(dl1);
        drawingPanelTrening.setPreferredSize(new java.awt.Dimension(200, 250));

        javax.swing.GroupLayout drawingPanelTreningLayout = new javax.swing.GroupLayout(drawingPanelTrening);
        drawingPanelTrening.setLayout(drawingPanelTreningLayout);
        drawingPanelTreningLayout.setHorizontalGroup(
            drawingPanelTreningLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        drawingPanelTreningLayout.setVerticalGroup(
            drawingPanelTreningLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );

        jPanel6.add(drawingPanelTrening, new java.awt.GridBagConstraints());

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel5Layout.createSequentialGroup()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, 278, Short.MAX_VALUE)
                    .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, 278, Short.MAX_VALUE))
                .addGap(10, 10, 10))
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, 334, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, 55, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        jPanel8.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(HWRVisualPanel1.class, "HWRVisualPanel1.jPanel8.border.title"))); // NOI18N

        jTree1.addTreeSelectionListener(new TreeSelectionListener() {
            public void valueChanged(TreeSelectionEvent evt) {
                TreePath[] paths = evt.getPaths();
                for (int i=0; i<paths.length; i++) {
                    if(!paths[i].getLastPathComponent().toString().contains("Lette")) {
                        if (evt.isAddedPath(i)) {
                            String path = new String();
                            String folder = TreeManager.getPath();
                            String file = paths[i].getLastPathComponent().toString();
                            path = folder + "/" + file;
                            jLabel2.setText(paths[i].getLastPathComponent().toString());
                            jImagePanel.setImage(path);
                            if(!jImagePanel.isVisible())
                            jImagePanel.setVisible(true);
                            break;
                        } else {

                            break;
                        }
                    } else {
                        jImagePanel.setVisible(false);
                        jLabel2.setText(new String());
                    }
                }
            }
        });
        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("Characters");
        jTree1.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));
        jScrollPane3.setViewportView(jTree1);

        javax.swing.GroupLayout jImagePanelLayout = new javax.swing.GroupLayout(jImagePanel);
        jImagePanel.setLayout(jImagePanelLayout);
        jImagePanelLayout.setHorizontalGroup(
            jImagePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );
        jImagePanelLayout.setVerticalGroup(
            jImagePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 100, Short.MAX_VALUE)
        );

        org.openide.awt.Mnemonics.setLocalizedText(clearTsButton, org.openide.util.NbBundle.getMessage(HWRVisualPanel1.class, "HWRVisualPanel1.clearTsButton.text")); // NOI18N
        clearTsButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearTsButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 190, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addGap(32, 32, 32)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 71, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel8Layout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 40, Short.MAX_VALUE)
                        .addComponent(jImagePanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(114, Short.MAX_VALUE))
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addGap(37, 37, 37)
                .addComponent(clearTsButton, javax.swing.GroupLayout.PREFERRED_SIZE, 134, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(283, Short.MAX_VALUE))
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addComponent(jLabel2)
                        .addGap(35, 35, 35)
                        .addComponent(jImagePanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(27, 27, 27)
                .addComponent(clearTsButton)
                .addContainerGap(63, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel5, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 473, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jPanel8, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void saveLetterTrainingButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveLetterTrainingButtonActionPerformed
        createTrainingSetFolder();
        try {
            String letter = JOptionPane.showInputDialog("Enter the drawn letter:").toUpperCase();
            drawingPanelTrening.saveDrawnLetter(letter);
            drawingPanelTrening.clearDrawingArea();
            TreeManager.setLettersTreeModel(jTree1);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(jTree1, "Cannot save letter - "+ex.getMessage(), "Warning!", JOptionPane.WARNING_MESSAGE);
        }
}//GEN-LAST:event_saveLetterTrainingButtonActionPerformed

    private void clearLetterTrainingButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearLetterTrainingButtonActionPerformed
        drawingPanelTrening.clearDrawingArea();
}//GEN-LAST:event_clearLetterTrainingButtonActionPerformed

    private void clearTsButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearTsButtonActionPerformed
        File lettersDir = new File(TreeManager.getPath());
        File[] letters = lettersDir.listFiles();
        for(int i=0; i < letters.length; i++) {
            letters[i].delete();
        }
        
         TreeManager.setLettersTreeModel(jTree1);
         jImagePanel.getGraphics().clearRect(0, 0, jImagePanel.getWidth(), jImagePanel.getHeight());
         jLabel2.setText("");
        
       
    }//GEN-LAST:event_clearTsButtonActionPerformed

    public static void createTrainingSetFolder() {
            File f = new File(TreeManager.getPath());
            if (!f.exists()) {
                f.mkdir();
            }    
    }    
        
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton clearLetterTrainingButton;
    private javax.swing.JButton clearTsButton;
    private org.neuroph.netbeans.hwr.wiz.DrawingPanel drawingPanelTrening;
    private org.neuroph.netbeans.hwr.wiz.JImagePanel jImagePanel;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTree jTree1;
    private javax.swing.JButton saveLetterTrainingButton;
    // End of variables declaration//GEN-END:variables
}